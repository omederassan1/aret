<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ“’ Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: linear-gradient(135deg, #3f51b5, #2196f3);
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .card {
      background: #fff;
      color: #333;
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 450px;
      margin: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    button {
      width: 100%;
      margin: 8px 0;
      padding: 14px;
      font-size: 18px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #1976d2; }
    select, input, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }
    h2, h3 { margin-bottom: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“’ Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>

    <div id="mainMenu">
      <button onclick="show('addDebt')">â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</button>
      <button onclick="show('payDebt')">ğŸ’° Ù‚Ø¨Ø¶ Ø¯ÙŠÙ†</button>
      <button onclick="show('statement')">ğŸ“„ ÙƒØ´Ù Ø­Ø³Ø§Ø¨</button>
      <button onclick="show('addClient')">ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
    </div>

    <div id="addDebt" class="hidden">
      <h3>Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</h3>
      <select id="debtClient"></select>
      <input type="number" id="debtAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
      <textarea id="debtNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©"></textarea>
      <button onclick="sendTransaction('Ø¯ÙŠÙ†')">Ø¥Ø¶Ø§ÙØ©</button>
      <p id="debtMsg"></p>
      <button onclick="back()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="payDebt" class="hidden">
      <h3>Ù‚Ø¨Ø¶ Ø¯ÙŠÙ†</h3>
      <select id="payClient"></select>
      <input type="number" id="payAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
      <textarea id="payNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©"></textarea>
      <button onclick="sendTransaction('Ù‚Ø¨Ø¶')">Ù‚Ø¨Ø¶</button>
      <p id="payMsg"></p>
      <button onclick="back()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="statement" class="hidden">
      <h3>ÙƒØ´Ù Ø­Ø³Ø§Ø¨</h3>
      <select id="clientList" onchange="getStatement()"></select>
      <div id="statementData"></div>
      <button onclick="back()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="addClient" class="hidden">
      <h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</h3>
      <input type="text" id="newClient" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
      <button onclick="addClient()">Ø¥Ø¶Ø§ÙØ©</button>
      <p id="clientMsg"></p>
      <button onclick="back()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbx6TYknUEt61F2_Vfpp9W4xpAGUWy25QJEZRgrtO1FZ05AGGPZQ6G2zWJ-WZ05zcZCpag/exec"; // â† Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Google Script

    async function api(data) {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });
      return await res.json();
    }

    function show(id) {
      document.querySelectorAll('.card > div').forEach(d => d.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      loadClients();
    }

    function back() {
      document.querySelectorAll('.card > div').forEach(d => d.classList.add('hidden'));
      document.getElementById('mainMenu').classList.remove('hidden');
    }

    async function loadClients() {
      const clients = await api({action: 'getClients'});
      ['debtClient','payClient','clientList'].forEach(id=>{
        const sel = document.getElementById(id);
        if (!sel) return;
        sel.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</option>';
        clients.forEach(c=>{
          const opt = document.createElement('option');
          opt.value = c; opt.textContent = c;
          sel.appendChild(opt);
        });
      });
    }

    async function sendTransaction(type) {
      const isDebt = type === 'Ø¯ÙŠÙ†';
      const client = document.getElementById(isDebt ? 'debtClient':'payClient').value;
      const amount = document.getElementById(isDebt ? 'debtAmount':'payAmount').value;
      const note = document.getElementById(isDebt ? 'debtNote':'payNote').value;
      const msg = document.getElementById(isDebt ? 'debtMsg':'payMsg');
      if (!client || !amount) return msg.textContent = 'â—Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„';
      msg.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
      const res = await api({action:'addTransaction', client, amount, note, type});
      msg.textContent = res;
    }

    async function addClient() {
      const name = document.getElementById('newClient').value.trim();
      const msg = document.getElementById('clientMsg');
      if (!name) return msg.textContent = 'â—Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…';
      msg.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
      const res = await api({action:'addClient', name});
      msg.textContent = res;
    }

    async function getStatement() {
      const client = document.getElementById('clientList').value;
      const div = document.getElementById('statementData');
      if (!client) return div.innerHTML = '';
      div.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
      const data = await api({action:'getStatement', client});
      if (!data.length) return div.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</p>';
      let html = `<table border="1" style="width:100%;margin:auto"><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr>`;
      data.forEach((r,i)=>{
        html += `<tr onclick="deleteRow('${client}',${i})"><td>${new Date(r[0]).toLocaleDateString()}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td></tr>`;
      });
      html += '</table>';
      div.innerHTML = html;
    }

    async function deleteRow(client, rowIndex) {
      const pass = prompt('ğŸ” Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ (1234) Ù„Ù„Ø­Ø°Ù:');
      if (!pass) return;
      const res = await api({action:'deleteTransaction', client, rowIndex, password: pass});
      alert(res);
      getStatement();
    }

    loadClients();
  </script>
</body>
</html>
